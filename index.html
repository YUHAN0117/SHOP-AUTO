<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç²¾é¸å°è³¼å•†å“</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; }
    h1 { margin:20px 0; }
    .grid { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; }
    .card { background:#222; border-radius:10px; padding:10px; width:200px; }
    .card img { width:100%; height:200px; object-fit:cover; border-radius:8px; background:#333; }
    .card h3 { font-size:16px; margin:10px 0; }
    .price { color:#0f0; font-weight:bold; margin:5px 0; }
    .btn { display:inline-block; background:#007bff; color:#fff; padding:8px 12px; border-radius:5px; text-decoration:none; }
    .btn:hover { background:#0056b3; }
    .rating { color:#ffcc00; font-size:14px; margin:5px 0; }
    .category { font-size:13px; color:#aaa; margin:5px 0; }
  </style>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0XBJ4VCQSM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-0XBJ4VCQSM');
  </script>
</head>
<body>
  <h1>ğŸ”¥ ç²¾é¸å°è³¼å•†å“ ğŸ”¥</h1>
  <div class="grid" id="productGrid">è¼‰å…¥ä¸­...</div>

  <script>
    // CSV è½‰æ›å‡½å¼
    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const headers = lines[0].split(",");
      return lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i] ? values[i].trim() : "");
        return obj;
      });
    }

    // è®€å– CSV ä¸¦ç”Ÿæˆå¡ç‰‡
    fetch("assets/data/products.csv")
      .then(res => res.text())
      .then(text => {
        const products = parseCSV(text);
        const grid = document.getElementById("productGrid");
        grid.innerHTML = "";
        products.forEach(p => {
          if (p.active !== "true") return; // åªé¡¯ç¤º active=true çš„å•†å“
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img src="${p.image}" alt="${p.title}">
            <h3>${p.title}</h3>
            <p class="price">NT$${p.price}</p>
            <p class="rating">â­ ${p.rating}</p>
            <p class="category">åˆ†é¡ï¼š${p.category}ï½œæ¨™ç±¤ï¼š${p.tags}</p>
            <a class="btn" href="${p.affiliate_url}" target="_blank" data-title="${p.title}">å‰å¾€è³¼è²·</a>
          `;
          grid.appendChild(card);
        });

        // ç¶å®š GA4 é»æ“Šäº‹ä»¶
        document.querySelectorAll(".btn").forEach(btn => {
          btn.addEventListener("click", function(e) {
            e.preventDefault();
            const url = this.href;
            const title = this.dataset.title;
            let navigated = false;
            function go(){ if(!navigated){ navigated=true; window.open(url,"_blank","noopener"); } }
            try {
              gtag('event','affiliate_click',{
                event_category: 'affiliate',
                event_label: url,
                item_name: title,
                event_callback: go,
                transport_type: 'beacon'
              });
              setTimeout(go,600); // ä¿éšªï¼š0.6 ç§’å¾Œå¼·åˆ¶é–‹å•Ÿ
            } catch(err){ go(); }
          });
        });
      })
      .catch(err => {
        document.getElementById("productGrid").innerHTML = "âŒ è¼‰å…¥å•†å“è³‡æ–™å¤±æ•—ï¼š" + err;
      });
  </script>
</body>
</html>
<div style="margin:18px 0 8px;">
  <h3>ğŸ“± æƒæ QR Code ç€è¦½å°è³¼ç«™</h3>
  <img
    src="https://yuhan0117.github.io/SHOP-AUTO/assets/img/qrcode.png?v=1"
    alt="å°è³¼ç«™ QR Code"
    width="220"
    height="220"
    loading="lazy">
</div>
