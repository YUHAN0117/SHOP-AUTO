<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç²¾é¸å°è³¼å•†å“</title>
  <meta name="robots" content="index,follow" />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0XBJ4VCQSM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-0XBJ4VCQSM');
  </script>

  <style>
    :root{
      --bg:#0f0f15; --card:#1b1f2a; --text:#e9ecf1; --muted:#9aa3b2;
      --primary:#2d7dff; --primary-2:#0f5ad9; --price:#15d47f; --star:#ffcc00;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Noto Sans TC",Arial;
         background:linear-gradient(180deg,#0f1016 0%,#0b0d13 100%); color:var(--text);}
    header{padding:28px 16px 8px; text-align:center}
    h1{margin:0 0 6px; font-size:28px}
    .sub{color:var(--muted); font-size:14px}
    .container{max-width:1100px; margin:18px auto 60px; padding:0 16px}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:14px;
          padding:12px; box-shadow:0 6px 16px rgba(0,0,0,.25); transition:.2s transform}
    .card:hover{transform:translateY(-3px)}
    .thumb{width:100%; height:200px; object-fit:cover; border-radius:10px; background:#0c0f14}
    .title{font-size:16px; margin:10px 2px 6px}
    .meta{display:flex; align-items:center; justify-content:space-between; margin:4px 2px}
    .price{color:var(--price); font-weight:700}
    .rating{color:var(--star); font-size:13px}
    .muted{color:var(--muted); font-size:12px; margin:4px 2px}
    .btn{display:inline-block; width:100%; text-align:center; margin-top:10px; padding:10px 12px;
         color:#fff; text-decoration:none; background:var(--primary); border-radius:8px; font-weight:600}
    .btn:hover{background:var(--primary-2)}
    .empty{padding:28px; text-align:center; color:var(--muted)}
    footer{color:var(--muted); text-align:center; padding:30px 0; font-size:12px}
  </style>
</head>
<body>
  <header>
    <h1>ğŸ”¥ ç²¾é¸å°è³¼å•†å“ ğŸ”¥</h1>
    <div class="sub">æ¯æ—¥æ›´æ–° Â· é»æ“Šã€Œå‰å¾€è³¼è²·ã€å³å¯å¸¶å…¥ä½ çš„åˆ†æ½¤é€£çµ</div>
  </header>

  <main class="container">
    <div id="productGrid" class="grid">
      <div class="empty">è¼‰å…¥ä¸­...</div>
    </div>
  </main>

  <footer>Â© <span id="y"></span> å°è³¼ç«™ Â· ç”± GitHub Pages è‡ªå‹•éƒ¨ç½²</footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // ç©©å®š CSV è§£æï¼ˆæ”¯æ´é€—è™Ÿ/å¼•è™Ÿ/æ›è¡Œï¼‰
    function parseCSV(text) {
      const rows = [];
      let row=[], val='', inQuotes=false;
      for (let i=0;i<text.length;i++){
        const c=text[i], n=text[i+1];
        if(inQuotes){
          if(c==='"' && n==='"'){ val+='"'; i++; }
          else if(c=== '"' ){ inQuotes=false; }
          else { val+=c; }
        }else{
          if(c=== '"'){ inQuotes=true; }
          else if(c=== ','){ row.push(val.trim()); val=''; }
          else if(c==='\n' || c==='\r'){
            if(val!=='' || row.length){ row.push(val.trim()); rows.push(row); row=[]; val=''; }
            if(c==='\r' && n==='\n') i++; // è™•ç† \r\n
          }else{ val+=c; }
        }
      }
      if(val!=='' || row.length){ row.push(val.trim()); rows.push(row); }
      const header=(rows.shift()||[]).map(h=>h.trim());
      return rows.map(r=>{
        const o={};
        header.forEach((h,i)=>o[h]= (r[i]||'').trim());
        return o;
      });
    }

    function renderProducts(list){
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      let shown = 0;

      list.forEach(p=>{
        const act = String(p.active||'').toLowerCase();
        // é¡¯ç¤ºæ¢ä»¶ï¼šactive ä¸æ˜¯æ˜ç¢º false/0/ç©º
        if(act && act!=='false' && act!=='0'){
          const img = p.image || 'assets/img/no-image.png';
          const title = p.title || '';
          const price = p.price ? 'NT$'+p.price : '';
          const rating = p.rating ? 'â­ '+p.rating : '';
          const cats = [p.category, p.tags].filter(Boolean).join('ï½œ');
          const url = p.affiliate_url || '#';

          grid.insertAdjacentHTML('beforeend', `
            <div class="card">
              <img class="thumb" src="${img}" alt="${title}"
                   onerror="this.src='assets/img/no-image.png'">
              <div class="title">${title}</div>
              <div class="meta">
                <div class="price">${price}</div>
                <div class="rating">${rating}</div>
              </div>
              <div class="muted">${cats}</div>
              <a class="btn" href="${url}" target="_blank" rel="nofollow noopener">å‰å¾€è³¼è²·</a>
            </div>
          `);
          shown++;
        }
      });

      if(!shown){
        grid.innerHTML = '<div class="empty">ï¼ˆæ²’æœ‰å¯é¡¯ç¤ºçš„å•†å“ï¼‰</div>';
      }
    }

    // è®€å– CSVï¼ˆå¾ /data/products.csvï¼Œé™„æ™‚é–“æˆ³é¿å…å¿«å–ï¼‰
    const csvUrl = 'data/products.csv?t=' + Date.now();
    fetch(csvUrl, { cache:'no-store' })
      .then(r=>{ if(!r.ok) throw new Error('HTTP '+r.status); return r.text(); })
      .then(txt => renderProducts(parseCSV(txt)))
      .catch(err=>{
        document.getElementById('productGrid').innerHTML =
          '<div class="empty">âŒ è¼‰å…¥å•†å“è³‡æ–™å¤±æ•—ï¼š' + (err?.message || err) + '</div>';
      });
  </script>
</body>
</html>
