<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>精選導購商品</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; }
    h1 { margin:20px 0; }
    .grid { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; }
    .card { background:#222; border-radius:10px; padding:10px; width:200px; }
    .card img { width:100%; height:200px; object-fit:cover; border-radius:8px; }
    .card h3 { font-size:16px; margin:10px 0; }
    .price { color:#0f0; font-weight:bold; margin:5px 0; }
    .btn { display:inline-block; background:#007bff; color:#fff; padding:8px 12px; border-radius:5px; text-decoration:none; }
    .btn:hover { background:#0056b3; }
    .rating { color:#ffcc00; font-size:14px; margin:5px 0; }
    .category { font-size:13px; color:#aaa; margin:5px 0; }
  </style>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0XBJ4VCQSM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-0XBJ4VCQSM');
  </script>
</head>
<body>
  <h1>🔥 精選導購商品 🔥</h1>
  <div class="grid" id="productGrid">載入中...</div>

  <script>
    // CSV 轉換函式
    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const headers = lines[0].split(",");
      return lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i] ? values[i].trim() : "");
        return obj;
      });
    }

    // 讀取 CSV 並生成卡片
    fetch("assets/data/products.csv")
      .then(res => res.text())
      .then(text => {
        const products = parseCSV(text);
        const grid = document.getElementById("productGrid");
        grid.innerHTML = "";
        products.forEach(p => {
          if (p.active !== "true") return; // 只顯示 active=true 的商品
          grid.innerHTML += `
            <div class="card">
              <img src="${p.image}" alt="${p.title}">
              <h3>${p.title}</h3>
              <p class="price">NT$${p.price}</p>
              <p class="rating">⭐ ${p.rating}</p>
              <p class="category">分類：${p.category}｜標籤：${p.tags}</p>
              <a class="btn" href="${p.affiliate_url}" target="_blank">前往購買</a>
            </div>
          `;
        });
      })
      .catch(err => {
        document.getElementById("productGrid").innerHTML = "❌ 載入商品資料失敗：" + err;
      });
  </script>
</body>
</html>
