<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>精選導購商品</title>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, "Noto Sans TC", Arial, sans-serif; background:#0f1620; color:#e9eef5; }
    .wrap { max-width:1100px; margin:0 auto; padding:22px 16px 40px; }
    h1 { margin:10px 0 18px; text-align:center; font-size:28px; }
    .grid { display:grid; grid-template-columns: repeat( auto-fill, minmax(220px,1fr) ); gap:16px; }
    .card { background:#1a2230; border-radius:12px; padding:12px; box-shadow:0 4px 14px rgba(0,0,0,.25); }
    .card img { width:100%; height:180px; object-fit:cover; border-radius:8px; background:#0b111a; }
    .card h3 { font-size:16px; margin:10px 0 6px; line-height:1.35; color:#fff; }
    .price { color:#00e676; font-weight:700; margin:4px 0 10px; }
    .btn { display:inline-block; background:#0b84ff; color:#fff; padding:8px 12px; border-radius:8px; text-decoration:none; font-weight:600; }
    .btn:hover { background:#056bd2; }
    footer { margin-top:28px; text-align:center; color:#9fb1c5; font-size:13px; }
    .qrcode img { width:160px; height:160px; border:6px solid #fff; border-radius:10px; box-shadow:0 0 12px rgba(0,0,0,.45); }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- 商品區（置頂顯示） -->
    <h1>🔥 精選導購商品 🔥</h1>
    <div class="grid">

      <div class="card">
        <img src="assets/img/S__25632790_0.jpg" alt="車載磁吸支架" loading="lazy">
        <h3>車載磁吸支架</h3>
        <p class="price">NT$134</p>
        <a class="btn" href="https://s.shopee.tw/6VEXZe6KES" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632788_0.jpg" alt="防臭地漏" loading="lazy">
        <h3>防臭地漏</h3>
        <p class="price">NT$189</p>
        <a class="btn" href="https://s.shopee.tw/113pmORd4" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632773_0.jpg" alt="多功能滑雪訓練器" loading="lazy">
        <h3>多功能滑雪訓練器</h3>
        <p class="price">NT$630</p>
        <a class="btn" href="https://s.shopee.tw/AKRG8ZP8vj" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632787_0.jpg" alt="家用除蟎機" loading="lazy">
        <h3>家用除蟎機</h3>
        <p class="price">NT$97</p>
        <a class="btn" href="https://s.shopee.tw/9AFIkRuCJD" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632791_0.jpg" alt="汽車遮陽蓬" loading="lazy">
        <h3>汽車遮陽蓬</h3>
        <p class="price">NT$406</p>
        <a class="btn" href="https://s.shopee.tw/9zoPk2xjAS" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632789_0.jpg" alt="智能霧化薰香機" loading="lazy">
        <h3>智能霧化薰香機</h3>
        <p class="price">NT$99</p>
        <a class="btn" href="https://s.shopee.tw/8KgBl4RYbz" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632786_0.jpg" alt="折疊鞋盒" loading="lazy">
        <h3>折疊鞋盒</h3>
        <p class="price">NT$584</p>
        <a class="btn" href="https://s.shopee.tw/2ViOoJflyR" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632792_0.jpg" alt="兩件式反光雨衣" loading="lazy">
        <h3>兩件式反光雨衣</h3>
        <p class="price">NT$599</p>
        <a class="btn" href="https://s.shopee.tw/7AUEMnQm5J" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632774_0.jpg" alt="五合一行動電源 10000mAh" loading="lazy">
        <h3>五合一行動電源 10000mAh</h3>
        <p class="price">NT$599</p>
        <a class="btn" href="https://s.shopee.tw/8Uzbx8Y0sU" target="_blank">前往購買</a>
      </div>

      <div class="card">
        <img src="assets/img/S__25632791_0.jpg" alt="後備箱收納神器" loading="lazy">
        <h3>後備箱收納神器</h3>
        <p class="price">NT$323</p>
        <a class="btn" href="https://s.shopee.tw/8KgBkxR9bI" target="_blank">前往購買</a>
      </div>

    </div>

    <!-- QR Section（想顯示就留，想拿掉就整段刪掉） -->
    <section class="qrcode" style="text-align:center; margin:32px 0 8px;">
      <h3>📱 也可掃描 QR Code 進站</h3>
      <img src="assets/img/qrcode.png?v=1" alt="導購站 QR Code" loading="lazy">
    </section>

    <footer>最後更新：<span id="ts"></span></footer>
  </div>

<script>
// 穩定 CSV 解析（支援含逗號/引號）
function parseCSV(text) {
  const rows = [];
  let row = [], val = '', inQuotes = false;

  for (let i = 0; i < text.length; i++) {
    const c = text[i], n = text[i+1];
    if (inQuotes) {
      if (c === '"' && n === '"') { val += '"'; i++; }      // 轉義雙引號 ""
      else if (c === '"') { inQuotes = false; }
      else { val += c; }
    } else {
      if (c === '"') inQuotes = true;
      else if (c === ',') { row.push(val.trim()); val = ''; }
      else if (c === '\n' || c === '\r') {
        if (val !== '' || row.length) { row.push(val.trim()); rows.push(row); row = []; val = ''; }
        if (c === '\r' && n === '\n') i++;                  // 處理 \r\n
      } else { val += c; }
    }
  }
  if (val !== '' || row.length) { row.push(val.trim()); rows.push(row); }

  const headers = (rows.shift() || []).map(h => h.trim());
  return rows.map(r => {
    const obj = {};
    headers.forEach((h, i) => obj[h] = (r[i] || '').trim());
    return obj;
  });
}

function renderProducts(list) {
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  let shown = 0;

  list.forEach(p => {
    const isActive = String(p.active || '').toLowerCase();
    if (isActive && isActive !== 'false' && isActive !== '0') {
      const img = p.image || 'assets/img/no-image.jpg';
      grid.insertAdjacentHTML('beforeend', `
        <div class="card">
          <img src="${img}" alt="${p.title || ''}" onerror="this.src='assets/img/no-image.jpg'">
          <h3>${p.title || ''}</h3>
          <p class="price">${p.price ? 'NT$' + p.price : ''}</p>
          <p class="rating">${p.rating ? '⭐ ' + p.rating : ''}</p>
          <p class="category">${[p.category, p.tags].filter(Boolean).join('｜')}</p>
          <a class="btn" href="${p.affiliate_url || '#'}" target="_blank" rel="nofollow noopener">前往購買</a>
        </div>
      `);
      shown++;
    }
  });

  if (!shown) grid.innerHTML = '（沒有可顯示的商品）';
}

// 讀取 data/products.csv（加上時間戳避免快取）
fetch("data/products.csv?t=" + Date.now(), { cache: 'no-store' })
  .then(r => { if (!r.ok) throw new Error('HTTP ' + r.status); return r.text(); })
  .then(text => renderProducts(parseCSV(text)))
  .catch(err => {
    document.getElementById('productGrid').innerHTML =
      '❌ 載入商品資料失敗：' + (err && err.message ? err.message : err);
  });
</script>
</body>
</html>
